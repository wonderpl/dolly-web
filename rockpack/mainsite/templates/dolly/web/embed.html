{% extends "web/layout.html" %}

{% block title %}{{ video_data.title }}{% endblock %}
{# start un-needed blocks #}
{% block itunes_app_data %}{% endblock %}
{% block ie_polyfills %}{% endblock %}
{% block typekit_fonts %}{% endblock %}
{% block dolly_css %}{% endblock %}
{% block google_maps_api %}{% endblock %}
{% block dolly_angular_lib %}{% endblock %}
{# end un-needed blocks #}

{% block page_css %}
  {% assets filters="less,cssmin", output="gen/wonderplayer_css.%(version)s.css",
  	depends="assets/wonderplayer/partials/_*.less",
  	"assets/wonderplayer/main.less"
  %}
  <style>
  {{ include_static_inline(ASSET_URL) }}
  </style>
  {% endassets %}

  {# Conditional stylesheet for IE8 and below #}
  <!--[if lte IE 10]>
  {% assets filters="less,cssmin", output="gen/wonderplayer_ie_css.%(version)s.css",
    depends="assets/wonderplayer/partials/_*.less",
    "assets/wonderplayer/ie.less"
  %}
  <style>
  {{ include_static_inline(ASSET_URL) }}
  </style>
  {% endassets %}
  <![endif]-->
{% endblock %}

{% block app_data %}
  <script type="text/javascript">
  	var videoData = {{ video_data|tojson }},
  	    ooyalaPlayerId = "{{ config.OOYALA_PLAYER_ID }}";
  </script>
{% endblock %}

{% block body_attributes %}class="embedded"{% endblock %}>

{% block body %}

 <div id='ooyalaplayer'></div>

  {% block scripts_footer %}

    <script type="text/javascript">
      var ua = window.navigator.userAgent.toLowerCase(), operacheck = ua.indexOf('opera') && ua.indexOf('opr/');
      document.write('<scr'+'ipt type="text/javascript" src="//player.ooyala.com/v3/{{ config.OOYALA_PLAYER_ID }}' + ( operacheck === -1 ? '?platform=html5-priority' : "" ) + '"><\/sc'+'ript>');
    </script>

    {#
      JQuery is only used for creation of SVG elements below and nowhere else.
      Remove as unneccessary if possible.
    #}
    {% assets filters="rjsmin", output="gen/video-module.%(version)s.js",
      "web-lite/conduit.js",
      "web-lite/video-module.js",
      "web-lite/vendor/jquery-1.11.0.min.js"
    %}<script type="text/javascript">{{ include_static_inline(ASSET_URL) }}</script>{% endassets %}

    <script type="text/javascript">

      // JQuery is being used here only, purely for the creation of complex elements
      function colorControls () {

        var rgb = JSON.parse(videoData.video.source_player_parameters.rgb);

        var svg = '<svg xmlns="http://www.w3.org/2000/svg" style="height: 0; width: 0;" id="ColourSvg"><filter id="ColourFilter" color-interpolation-filters="sRGB"><feComponentTransfer><feFuncR class="brightness red" type="linear" slope="1"/><feFuncG class="brightness green" type="linear" slope="1"/><feFuncB class="brightness blue" type="linear" slope="1"/></feComponentTransfer></filter></svg>';
        var style = '<style id="ColourStyle">.filtered { -webkit-filter : url("#ColourFilter"); -webkit-transform: translate3d(0px,0px,0px); -webkit-backface-visibility: hidden; -webkit-perspective: 1000; }</style>';

        var $filteredControls = $('.wonder-play, .wonder-pause, .wonder-volume, .wonder-logo, .wonder-fullscreen, .scrubber-handle, .scrubber-progress, .wonder-timer');
        $filteredControls.addClass('filtered');

        var $svg = $('#ColourSvg');
        if (!$svg.length) {
          $svg = $(svg);
          $('body').prepend($svg);
        }

        var $style = $('#ColourStyle');
        if (!$style.length) {
          $style = $(style);
          $('head').append($style);
        }

        $svg.find('.red').attr('slope', rgb.r/255);
        $svg.find('.green').attr('slope', rgb.g/255);
        $svg.find('.blue').attr('slope', rgb.b/255);
      }

      function hideLogo () {
        var hideLogo = videoData.video.source_player_parameters.hideLogo === "True" ? true : false;
        var controls = document.getElementById('wonder-controls');
        if (controls && hideLogo) {
          controls.className = controls.className + " no-logo";
        }
      }

      function showBuyButton () {
        var showBuyButton = videoData.video.source_player_parameters.showBuyButton === "True" ? true : false;
        var wrapper = document.getElementById('wonder-wrapper');
        if (wrapper && showBuyButton && videoData.video.link_title && videoData.video.link_url) {
          showBuyButton.innerHTML = videoData.video.link_title;
          showBuyButton.href = videoData.video.link_url;
          wrapper.className = wrapper.className + " show-buy-button";
        }
      }

      function showDescriptionButton () {
        var showDescriptionButton = videoData.video.source_player_parameters.showDescriptionButton === "True" ? true : false;
        var wrapper = document.getElementById('wonder-wrapper');
        if (wrapper && showDescriptionButton && videoData.video.link_title) {
          wrapper.className = wrapper.className + " show-description-button";
        }
      }

      function bindButtons () {
        var descriptionButton = document.getElementById('wonder-description-button');
        var videoDescription = document.getElementById('wonder-video-description');
        var videoDescriptionContent = document.getElementById('wonder-video-description-content');
        var closeDescription = document.getElementById('wonder-video-description-close');
        descriptionButton.addEventListener('click', function() {
          console.log(videoData.video);
          videoDescription.className = "active";
          videoDescriptionContent.innerHTML = videoData.video.description;
        }, false);
        closeDescription.addEventListener('click', function() {
          videoDescription.className = "";
        }, false);
      }
    </script>

  	<script type="text/javascript">
      var player = null;
  		OO.ready(function() {
  			player = window.wonder = OO.Player.create(
  				'ooyalaplayer', videoData.video.source_id,
  				{
  					flashParams: { hide: 'all' },
  					wmode: 'opaque',
  					layout: 'chromeless'
  				}
  			);
        hideLogo();
        showBuyButton();
        showDescriptionButton();
        colorControls();
        bindButtons();
  		});
  	</script>


  {% endblock %}
{% endblock %}

{% block google_analytics %}
  {{ super() }}
  <script type="text/javascript">
    ga('send', 'pageview');
  </script>
{% endblock %}